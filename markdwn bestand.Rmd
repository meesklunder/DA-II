---
title: "script/markdown assignment 2"
author: "Floris Meijvis en co"
date: "2024-10-14"
output: html_document
---
# Assignment 2

# Setting environment
```{r}
# lead packages
library(tidyverse)
library(lubridate)
library(class)
library(rpart)
library(rpart.plot)

# set seed for reproducibility
set.seed(45)

```
## Description of the dataset:

The dataset we'll be using for this second assignment contains information about maternity care from the last 15 jears, mainly from the regions North- and South-Holland, Utrecht and Gelderland. There's information about the expected and actyual deliviry date, where this happened, how many previous children have been born before, how many children will be born, etc. Some clients didn't complete their pregnancy with this specific caretaker, resulting in empty cells. 

Interesting questions to answer with a model on this dataset would be:

* can we predict if a childbirth will be medical or not?
* (maybe) can we predict when delivery will happen?


## data import
```{r}
Data = read.csv("Data.csv", sep = ";", fill = TRUE) %>%
  rename(Nr_Children = Aantal..kinderen, 
         Medical_Indication = Medische.indicatie,
         Hospital_code = Code_ziekenhuis,
         Medical_Indication_Birth = Medische.indicatie_Bevalling,
         Date_Expected_Birth = Datum.verwachte.bevalling,
         Date_Birth = Datum.bevalling,
         Time_Birth = Tijdstip.bevalling,
         Nr_Children_Expected = Aantal.kinderen.verwacht,
         Expected_Feeding = Voeding.verwacht,
         Time_Birth_Placenta = Tijdstip.geboorte.placenta,
         Date_Birth_Placenta = Datum.geboorte.placenta,
         Birthday_Parent = Geboortedatum,
         Work_Unit = Werkeenheid,
         Code_Work_Unit = Code_Werkeenheid,
         C_Section = Sectio,
         Gender_Parent = Geslacht,
         Code_Birth_Place = Code_PlaatsBevalling) %>%
  mutate(Work_Unit = as.factor(Work_Unit),
         Code_Work_Unit = as.factor(Code_Work_Unit),
         Hospital_code = as.factor(Hospital_code),
         Medical_Indication = as.factor(Medical_Indication),
         Medical_Indication_Birth = as.factor(Medical_Indication_Birth),
         C_Section = as.factor(C_Section),
         Code_Birth_Place = as.factor(Code_Birth_Place),
         Expected_Feeding = as.factor(Expected_Feeding),
         Gender_Parent = as.factor(Gender_Parent),
         Delta_AT = as.numeric(dmy(Date_Birth) - dmy(Date_Expected_Birth)),   #verschil tussen uitgerekende en daadwerkelijke bevallingsdatum in dagen (negatief = eerder bevallen dan)
         Age_Parent = as.integer((dmy(Date_Birth) - dmy(Birthday_Parent))/365)
         #Gender_parent = recode(Gender_Parent, V="F", M="M", O="N")
         ) 

Data[Data == ""] = NA
Data = filter(Data, !is.na(Data$Date_Birth))
```


```{r}
head(Data)
```

## Description of all collumns:

* __Work_Unit__: region
* __Code_Work_Unit__: region code
* __Date_Expected_Birth__: planned birth day (day-month-year)
* __Date_Birth__: real birth day (day-month-year)
* __Time_Birth__: moment of birth (hour:minute:second)
* __Nr_Children__: Amount of children previously birthed by client
* __Medical_Indication__: If previously thought to birth in hospital
* __Hospital_code__: Hospital code (_NA_ if birthed at home)
* __Medical_Indication_Birth__: If birth was in hospital
* __C_Section__: If the child was birthed using a C-section
* __Nr_Children_Expected__: How many children are expected to be born
* __Expected_Feeding__: What kind of feeding the parent is planning to give (1 = breast, ??)
* __Date_Birth_Placenta__: Date of placenta birth (day-month-year, empty if unknown) 
* __Time_Birth_Placenta__: Time of the placenta birth (hour:minute:second, empyt if unknown)
* __Birthday_Parent__: Birth day of the parent (day-month-year)
* __Gender_Parent__: Gender of the parent (F = female, M = male, N = neutral)
* __Code_Birth_Place__: Where the birth took place (Z = hospital, H = at home)
* __Delta_AT__: difference between expected and real birth day (negtaive number = earlier then expected)

## Investigating the data
```{r}
table(Data$Gender_Parent)
Data[Data$Gender_Parent != "V",]
```

It's interesting to see that there are genders that are not female.

```{r}
summary(Data)
```

It looks like there are people who had more than a year's difference in Delta_AT... something is not right there. All other categories look like they make sense though. 

## Divide into test and training set
```{r}
# there are 194093 rows, so 20% vs 80% divide for test and training sets
data_dummy <- Data %>% 
  mutate(div = sample(c(rep("train", 155274), rep("test", 38819))))

data_train <- filter(data_dummy, div=="train") %>% select(-div)
data_test <- filter(data_dummy, div=="test") %>% select(-div)

head(data_train)
```


## Classification tree

As a simple model, and to see what variables have an effect on whether the birth will be medical or not, make a decision tree with all information that can be known before birth. 
```{r}
tree <- rpart(Medical_Indication_Birth ~ Work_Unit + Nr_Children + Medical_Indication + Nr_Children_Expected + Gender_Parent + Age_Parent, data = data_train)
rpart.plot(tree)
```

It looks like these three variables have some effect. Strange is that not all previously planned medical births are actually medical in the end. It also looks like having had a previous child make the change of a medical birth lower. Lastly, it might be interesting to see why this specific work-force shows up as having a negative effect on having a medical birth.




